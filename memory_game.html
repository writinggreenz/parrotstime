<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ËÆ∞ÂøÜÁøªÁâå</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Press Start 2P', 'Courier New', monospace;
      background-color: #1a1a1a;
      color: #0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start; /* Align top for longer content */
      min-height: 100vh;
      padding: 20px;
      text-align: center;
      text-shadow: 0 0 5px #0f0;
    }
    .container {
      background-color: #000;
      padding: 20px;
      border: 4px solid #0f0;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
      width: 95%;
      max-width: 600px;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 15px;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
      font-size: 1rem;
    }
    .stats span { color: #ff0; } /* Yellow for stat values */

    .memory-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr); /* Default 4 columns */
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .card {
      background-color: #333; /* Face down color */
      border: 2px solid #0f0;
      aspect-ratio: 1 / 1; /* Square cards */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem; /* Adjust based on card content */
      cursor: pointer;
      transition: transform 0.3s, background-color 0.3s;
      user-select: none;
    }
    .card.flipped {
      background-color: #555; /* Face up color */
      transform: rotateY(180deg); /* Basic flip effect */
      cursor: default;
    }
    .card.matched {
      background-color: #0a0; /* Matched color (darker green) */
      color: #ccc;
      cursor: default;
      opacity: 0.7;
    }
    .card .content { /* Content shown when flipped */
        transform: rotateY(180deg); /* Counter-rotate content */
        display: none; /* Hidden by default */
    }
    .card.flipped .content {
        display: block;
    }

    button#reset-game-btn {
      background: #111;
      border: 3px solid #0f0;
      color: #0f0;
      padding: 10px 20px;
      font-family: inherit;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.2s, color 0.2s;
    }
    button#reset-game-btn:hover {
      background: #0f0;
      color: #000;
    }
    .feedback {
      margin-top: 15px;
      font-size: 1.1rem;
      min-height: 25px;
    }
    .back-link {
      display: inline-block;
      margin-top: 30px;
      padding: 8px 15px;
      border: 2px solid #f00;
      color: #f00;
      text-decoration: none;
      font-size: 0.9rem;
      transition: background .2s, color .2s;
    }
    .back-link:hover {
      background: #f00;
      color: #000;
    }

    /* Responsive for smaller grids if needed */
    @media (max-width: 480px) {
      .memory-grid {
        grid-template-columns: repeat(3, 1fr); /* 3 columns on small screens */
      }
      .card { font-size: 1.5rem; }
      h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ËÆ∞ÂøÜÁøªÁâå</h1>
    <div class="stats">
      <div>Ê≠•Êï∞: <span id="moves-count">0</span></div>
      <div>Â∑≤ÂåπÈÖç: <span id="matched-pairs-count">0</span> / <span id="total-pairs-count">0</span></div>
    </div>
    <div class="memory-grid" id="memory-game-grid">
      <!-- Cards will be generated by JavaScript -->
    </div>
    <button id="reset-game-btn">ÈáçÊñ∞ÂºÄÂßã</button>
    <div class="feedback" id="feedback-text"></div>
  </div>
  <a href="index.html" class="back-link">‚Üê ËøîÂõûÁõ∏ÂÜå</a>

  <script>
    const gridContainer = document.getElementById('memory-game-grid');
    const movesCountEl = document.getElementById('moves-count');
    const matchedPairsCountEl = document.getElementById('matched-pairs-count');
    const totalPairsCountEl = document.getElementById('total-pairs-count');
    const feedbackTextEl = document.getElementById('feedback-text');
    const resetGameBtn = document.getElementById('reset-game-btn');

    // Game settings
    let symbols = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L']; // Max symbols for up to 6x4 or 4x6 grid (12 pairs)
    let cards = []; // Array to hold card data
    let flippedCards = []; // Max 2 cards
    let matchedPairs = 0;
    let totalPairs = 0;
    let moves = 0;
    let canFlip = true; // To prevent flipping more than 2 cards or during timeout

    function determineGridConfig() {
        let numCols = 4;
        let numRows = 4;
        if (window.innerWidth < 480) { // Matches CSS media query for 3 columns
            numCols = 3;
            numRows = 4;
        } else if (window.innerWidth < 350) { // Even smaller screens
             numCols = 2;
             numRows = 4; // 2x4 grid = 8 cards = 4 pairs
        }

        const numCards = numCols * numRows;
        if (numCards % 2 !== 0) {
            // Ensure even number of cards if one dimension is odd, adjust smallest dimension
            if (numCols > numRows) numCols--; else numRows--;
            totalPairs = (numCols * numRows) / 2;
        } else {
            totalPairs = numCards / 2;
        }

        const availableSymbols = ['üåü', 'üíñ', 'üöÄ', 'üçï', 'üéâ', 'üéà', 'üéÅ', 'üç©', 'üí°', 'üßä', 'üî•', 'üîî'];
        let currentSymbolsPool = symbols;
        if (typeof availableSymbols !== 'undefined' && availableSymbols.length >= totalPairs) {
            currentSymbolsPool = availableSymbols;
        }

        const requiredSymbols = currentSymbolsPool.slice(0, totalPairs);
        let gameSymbols = [...requiredSymbols, ...requiredSymbols];

        gameSymbols.sort(() => Math.random() - 0.5);

        return { numCols, numRows, gameSymbols, numCards };
    }

    function initGame() {
      const gridConfig = determineGridConfig();
      cards = [];
      flippedCards = [];
      matchedPairs = 0;
      moves = 0;
      canFlip = true;
      gridContainer.innerHTML = '';
      gridContainer.style.gridTemplateColumns = `repeat(${gridConfig.numCols}, 1fr)`;

      // Update total pairs display
      totalPairs = gridConfig.numCards / 2; // Recalculate based on actual numCards from config
      totalPairsCountEl.textContent = totalPairs;


      movesCountEl.textContent = moves;
      matchedPairsCountEl.textContent = matchedPairs;
      feedbackTextEl.textContent = 'ÂºÄÂßãÂåπÈÖç!';

      for (let i = 0; i < gridConfig.gameSymbols.length; i++) {
        const card = document.createElement('div');
        card.classList.add('card');
        card.dataset.value = gridConfig.gameSymbols[i];

        const content = document.createElement('div');
        content.classList.add('content');
        content.textContent = gridConfig.gameSymbols[i];
        card.appendChild(content);

        card.addEventListener('click', () => handleCardClick(card));
        gridContainer.appendChild(card);
        cards.push(card);
      }
    }

    function handleCardClick(card) {
      if (!canFlip || card.classList.contains('flipped') || card.classList.contains('matched')) {
        return;
      }

      card.classList.add('flipped');
      // Content visibility is handled by CSS (.card.flipped .content)

      flippedCards.push(card);

      if (flippedCards.length === 2) {
        canFlip = false;
        moves++;
        movesCountEl.textContent = moves;
        checkForMatch();
      }
    }

    function checkForMatch() {
      const [card1, card2] = flippedCards;
      if (card1.dataset.value === card2.dataset.value) {
        feedbackTextEl.textContent = 'ÂåπÈÖçÊàêÂäü!';
        card1.classList.add('matched');
        card2.classList.add('matched');
        matchedPairs++;
        matchedPairsCountEl.textContent = matchedPairs;
        flippedCards = [];
        canFlip = true;
        checkWinCondition();
      } else {
        feedbackTextEl.textContent = '‰∏çÂåπÈÖç, ÂÜçËØï‰∏ÄÊ¨°!';
        setTimeout(() => {
          card1.classList.remove('flipped');
          card2.classList.remove('flipped');
          // Content visibility handled by CSS
          flippedCards = [];
          canFlip = true;
        }, 1000);
      }
    }

    function checkWinCondition() {
      if (matchedPairs === totalPairs) {
        feedbackTextEl.textContent = \`ÊÅ≠Âñú! ‰Ω†Áî® ${moves} Ê≠•ÂÆåÊàê‰∫ÜÊ∏∏Êàè!\`;
        canFlip = false;
      }
    }

    resetGameBtn.addEventListener('click', initGame);
    window.addEventListener('resize', initGame); // Re-initialize on resize for responsive grid

    // Initial game setup
    initGame();
  </script>
</body>
</html>
